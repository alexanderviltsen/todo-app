<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üìã Todo –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h1>
            <nav>
                <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="/tasks">–ó–∞–¥–∞—á–∏</a>
                <a href="/calendar">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
                <a href="/statistics" class="active">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
            </nav>
        </header>

        <div class="content">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á</h2>

            <div id="stats-container" class="stats-grid">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
            </div>

            <div style="margin-top: 40px;">
                <h3 style="margin-bottom: 20px;">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å</h3>
                <div style="background: #f9fafb; padding: 30px; border-radius: 12px;">
                    <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 18px; font-weight: 500;">–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</span>
                        <span id="completion-percentage" style="font-size: 24px; font-weight: bold; color: #667eea;">0%</span>
                    </div>
                    <div style="background: #e5e7eb; border-radius: 10px; height: 30px; overflow: hidden;">
                        <div id="progress-bar" style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 40px;">
                <h3 style="margin-bottom: 20px;">üìÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏</h3>
                <div id="recent-tasks-container"></div>
            </div>
        </div>
    </div>

    <script th:src="@{/js/api.js}"></script>
    <script>
        async function loadStatistics() {
            try {
                const stats = await api.getStatistics();
                const container = document.getElementById('stats-container');
                
                const percentage = stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0;
                
                container.innerHTML = `
                    <div class="stat-card">
                        <h3>–í—Å–µ–≥–æ –∑–∞–¥–∞—á</h3>
                        <div class="stat-value">${stats.total}</div>
                    </div>
                    <div class="stat-card">
                        <h3>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</h3>
                        <div class="stat-value">${stats.completed}</div>
                    </div>
                    <div class="stat-card">
                        <h3>–í –ø—Ä–æ—Ü–µ—Å—Å–µ</h3>
                        <div class="stat-value">${stats.incomplete}</div>
                    </div>
                `;

                // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                document.getElementById('completion-percentage').textContent = percentage + '%';
                document.getElementById('progress-bar').style.width = percentage + '%';

                // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏
                loadRecentTasks();
            } catch (error) {
                utils.showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ' + error.message);
            }
        }

        async function loadRecentTasks() {
            try {
                const tasks = await api.getAllTasks();
                const recentTasks = tasks.slice(-5).reverse();
                const container = document.getElementById('recent-tasks-container');

                if (recentTasks.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #6b7280;">–ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                    return;
                }

                container.innerHTML = recentTasks.map(task => `
                    <div class="day-task" style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 500;">${task.description}</span>
                            <span style="font-size: 12px; color: #6b7280;">${utils.formatDate(task.createdAt)}</span>
                        </div>
                        ${task.completed ? '<span style="color: #10b981; font-size: 14px;">‚úî –ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>' : '<span style="color: #f59e0b; font-size: 14px;">‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>'}
                    </div>
                `).join('');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–¥–∞—á:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', loadStatistics);
    </script>
</body>
</html>
