<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App - –ö–∞–ª–µ–Ω–¥–∞—Ä—å</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üìã Todo –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h1>
            <nav>
                <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="/app/tasks">–ó–∞–¥–∞—á–∏</a>
                <a href="/app/calendar" class="active">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
                <a href="/app/statistics">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
            </nav>
        </header>

        <div class="content">
            <h2>üóìÔ∏è –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–¥–∞—á –Ω–∞ –Ω–µ–¥–µ–ª—é</h2>

            <div id="calendar-container" class="calendar-grid">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è...</div>
            </div>
        </div>
    </div>

    <script th:src="@{/js/api.js}"></script>
    <script>
        const daysOfWeek = [
            { en: 'Monday', ru: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', emoji: 'üîµ' },
            { en: 'Tuesday', ru: '–í—Ç–æ—Ä–Ω–∏–∫', emoji: 'üü¢' },
            { en: 'Wednesday', ru: '–°—Ä–µ–¥–∞', emoji: 'üü°' },
            { en: 'Thursday', ru: '–ß–µ—Ç–≤–µ—Ä–≥', emoji: 'üü†' },
            { en: 'Friday', ru: '–ü—è—Ç–Ω–∏—Ü–∞', emoji: 'üî¥' },
            { en: 'Saturday', ru: '–°—É–±–±–æ—Ç–∞', emoji: 'üü£' },
            { en: 'Sunday', ru: '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', emoji: 'üü°' }
        ];

        async function loadCalendar() {
            const container = document.getElementById('calendar-container');
            utils.showLoading(container);

            try {
                const allTasks = await api.getAllTasks();
                
                const tasksByDay = {};
                daysOfWeek.forEach(day => {
                    tasksByDay[day.en] = allTasks.filter(t => t.dayOfWeek === day.en);
                });

                container.innerHTML = daysOfWeek.map(day => {
                    const dayTasks = tasksByDay[day.en];
                    const completedCount = dayTasks.filter(t => t.completed).length;
                    const totalCount = dayTasks.length;

                    return `
                        <div class="day-card">
                            <h3>${day.emoji} ${day.ru}</h3>
                            <div style="margin-bottom: 15px; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-size: 14px; color: #6b7280; margin-bottom: 5px;">
                                    –í—Å–µ–≥–æ: ${totalCount} | –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${completedCount}
                                </div>
                                <div style="background: #e5e7eb; border-radius: 5px; height: 8px; overflow: hidden;">
                                    <div style="background: #10b981; height: 100%; width: ${totalCount > 0 ? (completedCount / totalCount * 100) : 0}%; transition: width 0.3s;"></div>
                                </div>
                            </div>
                            <div class="day-tasks">
                                ${dayTasks.length === 0 ? 
                                    '<p style="text-align: center; color: #6b7280; padding: 20px;">–ó–∞–¥–∞—á –Ω–µ—Ç</p>' :
                                    dayTasks.map(task => `
                                        <div class="day-task ${task.completed ? 'completed' : ''}">
                                            <div style="display: flex; justify-content: space-between; align-items: start; gap: 10px;">
                                                <span style="flex: 1;">${task.description}</span>
                                                ${task.completed ? 
                                                    '<span style="color: #10b981; font-size: 18px;">‚úî</span>' : 
                                                    '<span style="color: #f59e0b; font-size: 18px;">‚è≥</span>'
                                                }
                                            </div>
                                        </div>
                                    `).join('')
                                }
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                utils.showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è: ' + error.message);
                container.innerHTML = '';
            }
        }

        document.addEventListener('DOMContentLoaded', loadCalendar);
    </script>
</body>
</html>
